From 1f6e08c228813358d61cd307dc299bf8d10bd748 Mon Sep 17 00:00:00 2001
From: Charles Stevens <charles.stevens@logicpd.com>
Date: Tue, 24 Mar 2020 14:22:01 -0500
Subject: [PATCH 07/18] Set output mode on output 2 to get camera working

---
 drivers/clk/clk-versaclock5.c | 12 +++++++++++-
 1 file changed, 11 insertions(+), 1 deletion(-)

diff --git a/drivers/clk/clk-versaclock5.c b/drivers/clk/clk-versaclock5.c
index 176b4e5fa746..67f66d7ac289 100755
--- a/drivers/clk/clk-versaclock5.c
+++ b/drivers/clk/clk-versaclock5.c
@@ -601,6 +601,7 @@ static int vc5_clk_out_prepare(struct clk_hw *hw)
 	 * select source from matching FOD.
 	 */
 	regmap_read(vc5->regmap, VC5_OUT_DIV_CONTROL(hwdata->num), &src);
+	printk (KERN_ERR "vc5 a %x, %x \n", (unsigned int) VC5_CLK_OUTPUT_CFG(hwdata->num, 1), (unsigned int) src);
 	if ((src & mask) == 0) {
 		src = VC5_OUT_DIV_CONTROL_RESET | VC5_OUT_DIV_CONTROL_EN_FOD;
 		ret = regmap_update_bits(vc5->regmap,
@@ -611,17 +612,26 @@ static int vc5_clk_out_prepare(struct clk_hw *hw)
 	}
 
 	/* Enable the clock buffer */
-	printk (KERN_ERR "vc5 %x, %x \n", (unsigned int) VC5_CLK_OUTPUT_CFG(hwdata->num, 1), (unsigned int) VC5_CLK_OUTPUT_CFG1_EN_CLKBUF);
+	printk (KERN_ERR "vc5 b %x, %x \n", (unsigned int) VC5_CLK_OUTPUT_CFG(hwdata->num, 1), (unsigned int) VC5_CLK_OUTPUT_CFG1_EN_CLKBUF);
 	regmap_update_bits(vc5->regmap, VC5_CLK_OUTPUT_CFG(hwdata->num, 1),
 			   VC5_CLK_OUTPUT_CFG1_EN_CLKBUF,
 			   VC5_CLK_OUTPUT_CFG1_EN_CLKBUF);
 	if (hwdata->num == 3)
 	{
+		printk (KERN_ERR "vc5 Update output 4\n");
 		/* Set output 4 to 3.3 volt operation */
 		regmap_update_bits(vc5->regmap, VC5_CLK_OUTPUT_CFG(hwdata->num, 0),
 			0xF8,
 			0xB8);
 	}
+	if (hwdata->num == 1)
+	{
+		printk (KERN_ERR "vc5 Update output 2\n");
+		/* Set output 2 to 3.3 volt operation CMOS */
+		regmap_update_bits(vc5->regmap, VC5_CLK_OUTPUT_CFG(hwdata->num, 0),
+			0xF8,
+			0x38);
+	}
 	return 0;
 }
 
-- 
2.17.1

